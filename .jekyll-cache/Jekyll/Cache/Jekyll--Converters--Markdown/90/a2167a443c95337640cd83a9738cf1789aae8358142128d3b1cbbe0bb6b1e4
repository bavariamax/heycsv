I"8e<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container-fluid">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavDropdown">
      <ul class="navbar-nav">
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            Sample CSV files
          </a>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
            <li><a class="dropdown-item" href="#" onclick="onBtnDemo1()">Load 1000 Sample Companies</a></li>
            <li><a class="dropdown-item" href="#" onclick="onBtnDemo2()">Load 1000 Sample Products</a></li>
            <li><a class="dropdown-item" href="#" onclick="onBtnDemo3()">Load 1000 Sample Users</a></li>
            <li><a class="dropdown-item" href="#" onclick="onBtnDemo4()">Load 100k Sample Users</a></li>
          </ul>
        </li> 
        <li class="nav-item">
          <a class="nav-link bi-gear" aria-current="page" id="navbarSettings" href="#" data-bs-toggle="modal" data-bs-target="#settingsModal"> Format Settings</a>
        </li>
        <li class="nav-item">
          <a class="nav-link bi-arrow-repeat disabled" aria-current="page" id="reload" href="#" onclick="onBtnReload()"> Reload Data</a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle bi-download disabled" href="#" id="navbarExport" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            Export
          </a>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
            <li><a class="dropdown-item" href="#" onclick="onBtnExportCsv()"> CSV Export</a></li>
            <li><a class="dropdown-item" href="#" onclick="onBtnExportExcel()"> Excel Export</a></li>
          </ul>
        </li>
        <li class="nav-item">
          <a class="nav-link bi-x-circle disabled" aria-current="page" id="navbarReset" href="#" onclick="onBtnReset()"> Reset</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<!-- Format Settings Modal -->
<div class="modal fade" id="settingsModal" tabindex="-1" aria-labelledby="settingsModalLabel" aria-hidden="true" style="z-index: 3147483646;">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="settingsModalLabel">Format Settings</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
      	  <div class="container-fluid">
				    <div class="row">
				      <div class="col-md-3">Header Row</div>
				      <div class="col-md-9 ms-auto form-check form-switch">
				      	<input class="form-check-input" type="checkbox" id="headerChecked" onclick="updatePreview();" checked="" />
							</div>
				    </div>
				    <div class="row">
				      <div class="col-md-3">Column Delimiter</div>
				      <div class="col-md-9 ms-auto">
								<div class="form-check form-check-inline">
								  <input class="form-check-input" type="radio" name="delimiterInput" id="delimiterComma" value="," onclick="updatePreview();" checked="" />
								  <label class="form-check-label" for="delimiterComma">Comma ,</label>
								</div>
								<div class="form-check form-check-inline">
								  <input class="form-check-input" type="radio" name="delimiterInput" id="delimiterSemicolon" value=";" onclick="updatePreview();" />
								  <label class="form-check-label" for="delimiterSemicolon">Semicolon ;</label>
								</div>
								<div class="form-check form-check-inline">
								  <input class="form-check-input" type="radio" name="delimiterInput" id="delimiterBar" value="|" onclick="updatePreview();" />
								  <label class="form-check-label" for="delimiterBar">Vertical bar |</label>
								</div>
								<div class="form-check form-check-inline">
								  <input class="form-check-input" type="radio" name="delimiterInput" id="delimiterTab" value="&#9;" onclick="updatePreview();" />
								  <label class="form-check-label" for="delimiterTab">Tab</label>
								</div>
								<div class="form-check form-check-inline">
								  <input class="form-check-input" type="radio" name="delimiterInput" id="delimiterSpace" value=" " onclick="updatePreview();" />
								  <label class="form-check-label" for="delimiterSpace">Space</label>
								</div>
							</div>
				    </div>
				    <div class="row">
				      <div class="col-md-3">Quotation</div>
				      <div class="col-md-9 ms-auto">
								<div class="form-check form-check-inline">
								  <input class="form-check-input" type="radio" name="quotesInput" id="quotesTrue" value="&quot;" onclick="updatePreview();" checked="" />
								  <label class="form-check-label" for="quotesTrue">"True"</label>
								</div>
								<div class="form-check form-check-inline">
								  <input class="form-check-input" type="radio" name="quotesInput" id="quotesFalse" value="" onclick="updatePreview();" />
								  <label class="form-check-label" for="quotesFalse">False</label>
								</div>
							</div>
				    </div>
  				</div>
      </div>
      <div class="modal-body" style="border-top:  1px solid #dee2e6;">
         <h6>Preview</h6>
         <div class="container">
  				<div class="row justify-content-start">
  					<div class="col-md-4" id="previewLeft" style="border: 1px solid grey;">
  						Name,Age,Favorite Color<br />
  						"John","25","blue"<br />
							"Mary","33","green"<br />
							"Mike","51","red"
				    </div>
				    <div class="col-md-2" style="display: grid; justify-content: center; align-items: center;">
				      <svg xmlns="http://www.w3.org/2000/svg" class="bi bi-chevron-compact-right" viewBox="0 0 16 16" width="64" height="64" fill="grey">
  <path fill-rule="evenodd" d="M6.776 1.553a.5.5 0 0 1 .671.223l3 6a.5.5 0 0 1 0 .448l-3 6a.5.5 0 1 1-.894-.448L9.44 8 6.553 2.224a.5.5 0 0 1 .223-.671z"></path>
</svg>
				    </div>
				    <div class="col-md-6">
				    	<div class="row" id="previewHeaderRow1" style="display: flex; border-bottom: 1px solid #ccc; background-color: rgb(245, 247, 247);">
					    	<div class="col-md-3"><b>Name</b></div>
					    	<div class="col-md-3"><b>Age</b></div>
					    	<div class="col-md-6"><b>Favorite Color</b></div>
					    </div>
					    <div class="row" id="previewHeaderRow2" style="display: none;border-bottom: 1px solid #ccc; background-color: rgb(245, 247, 247);">
					    	<div class="col-md-3"><b>Column 1</b></div>
					    	<div class="col-md-3"><b>Column 2</b></div>
					    	<div class="col-md-6"><b>Column 3</b></div>
					    </div>
				    	<div class="row" style="border-bottom: 1px solid #ccc;">
					    	<div class="col-md-3">John</div>
					    	<div class="col-md-3">25</div>
					    	<div class="col-md-6">blue</div>
					    </div>
					    <div class="row" style="border-bottom: 1px solid #ccc;">
					    	<div class="col-md-3">Mary</div>
					    	<div class="col-md-3">33</div>
					    	<div class="col-md-6">green</div>
					    </div>
					    <div class="row" style="border-bottom: 1px solid #ccc;">
					    	<div class="col-md-3">Mike</div>
					    	<div class="col-md-3">51</div>
					    	<div class="col-md-6">red</div>
					    </div>
				    </div>
  				 </div>
				 </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<div class="wrapper" style="padding: 20px;">
<div id="inputArea" style="margin-bottom: 100px;">
	<div id="picker" style="height: 200px;"></div>
	<div style="padding: 30px;">Or paste text below:</div>
	<div><textarea id="pasteText" style="width:100%; height: 200px;"></textarea>
		<button onclick="inputGrid()">Parse Text</button></div>
</div>


</div>

<div class="loadingDiv" style="display: none;">
  <div class="loadingSpinner">
    <div></div><div><div></div></div>
  </div>
</div>

<div id="gridWrapper" style="display: none;">
<div style="border-top: 1px solid #bdc3c7; background-color: rgb(245, 247, 247);">
	<div id="fileTitle" style="font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif; font-size: 14px; padding-left: 40px; height: 32px; background-color: rgb(245, 247, 247); display: table-cell; vertical-align: middle;"></div>
</div>
<div style="border-top: 1px solid #bdc3c7;">
	<input type="text" oninput="onQuickFilterChanged()" id="quickFilter" placeholder="Quick search..." style="font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif; font-size: 12px; padding-left: 40px; line-height: normal; height: 32px; border: none; outline-width: 0; width: 100%; background-color: rgb(245, 247, 247);" />
</div>
<div id="csvGrid" style="height: 1000px; width: 100%;" class="ag-theme-balham"></div>
</div>

<p><input type="hidden" value="" id="loadedUrl" /></p>

<script src="//static.filestackapi.com/filestack-js/3.x.x/filestack.min.js"></script>

<script type="text/javascript" charset="utf-8">


//
// Settings Preview
//

function updatePreview(){
	var delimiter =  $("input[type='radio'][name='delimiterInput']:checked").val();
  var quotes = $("input[type='radio'][name='quotesInput']:checked").val();
  var header = document.querySelector("#headerChecked").checked;

	var col1 = ["John", "Mary", "Mike"];
	var col2 = ["25", "33", "51"];
	var col3 = ["blue", "green", "red"];

	document.querySelector("#previewLeft").innerHTML = "";

	if(header) {
		document.querySelector("#previewLeft").innerHTML += "Name" + delimiter + "Age" + delimiter + "Favorite Color" + "<br />";
		document.querySelector("#previewHeaderRow1").style.display = "flex";
		document.querySelector("#previewHeaderRow2").style.display = "none";
	} else {
		document.querySelector("#previewHeaderRow1").style.display = "none";
		document.querySelector("#previewHeaderRow2").style.display = "flex";
	}

	for(i=0;i<3;i++) {
		document.querySelector("#previewLeft").innerHTML += quotes + col1[i] + quotes + delimiter + col2[i] + delimiter + quotes + col3[i] + quotes + "<br />";
	}

}


//
// URL Parameter
// 
const queryString = window.location.search;
const urlParams = new URLSearchParams(queryString);

if(urlParams.has('s')){
	 const s = urlParams.get('s');
	 createGridUrl(s);
}

//
// Menu Links
// 

function onBtnDemo1() {
  if(gridOptions.api) gridOptions.api.destroy();
  createGridUrl("https://www.heycsv.com/downloads/sample-csv/1k-sample-companies.csv");
}

function onBtnDemo2() {
  if(gridOptions.api) gridOptions.api.destroy();
  createGridUrl("https://www.heycsv.com/downloads/sample-csv/1k-sample-products.csv");
}

function onBtnDemo3() {
  if(gridOptions.api) gridOptions.api.destroy();
  createGridUrl("https://www.heycsv.com/downloads/sample-csv/1k-sample-users.csv");
}

function onBtnDemo4() {
  if(gridOptions.api) gridOptions.api.destroy();
  createGridUrl("https://www.heycsv.com/downloads/sample-csv/100k-sample-users.csv");
}

function onBtnReset() {
  document.querySelector(".wrapper").style.display = "block";
  document.querySelector("#fileTitle").innerHTML = "";
  document.querySelector("#loadedUrl").value = "";
  var element = document.getElementById("navbarExport");
  element.classList.add("disabled");
  element = document.getElementById("navbarReset");
  element.classList.add("disabled");
  element = document.getElementById("reload");
  element.classList.add("disabled");
  if(gridOptions.api) gridOptions.api.destroy();
  document.querySelector("#gridWrapper").style.display = "none";
}

function onBtnReload() {
	if(gridOptions.api) gridOptions.api.destroy();
	// check if data got inputted in text area or via URL
	if(document.querySelector("#loadedUrl").value == "") {
		console.log("reload inputGrid");
		inputGrid();
	} else {
		console.log("reload: " + document.querySelector("#loadedUrl").value);
		createGridUrl(document.querySelector("#loadedUrl").value);
	}
}

function onBtnExportCsv() {
	var params = getExportParams("csv");
	gridOptions.api.exportDataAsCsv(params);
}

function onBtnExportExcel() {
	var params = getExportParams("xls");
	gridOptions.api.exportDataAsExcel(params);
}

function getExportParams(ending) {
  var delimiter =  $("input[type='radio'][name='delimiterInput']:checked").val();
  var quotes = $("input[type='radio'][name='quotesInput']:checked").val();
  var supQuotes = false;
  if(quotes == "") supQuotes = true;
  return {
    fileName: formatDate() + "_export." + ending,
	  columnSeparator: delimiter,
	  suppressQuotes: supQuotes  
  };
}

function onBtnTest1() {
	console.log("Test 1");
	const columnDefs = gridOptions.api.getColumnDefs();
	const newColumnDefs = [];

	 for (var n = i = 0; n < columnDefs.length + 1; n++) {

		 	if(n == 1) {
					var newCol = { 
		              colId: "Col_" + n,
		              field: "new_" + n,
		              headerName: "New",
		              editable: true,
		              sortable: true,
				          filter: true,
				          resizable: true,
				          enableRowGroup: true,
				          enableValue: true,
				          enablePivot: true,
				          hide: false
		          	};
		      newColumnDefs.push(newCol);
			 } else {
			 	columnDefs[i].colId = "Col_" + n;
			  newColumnDefs.push(columnDefs[i]);
				++i;
			 }
		
	 }
	console.log(newColumnDefs);
	gridOptions.api.setColumnDefs(newColumnDefs);
}

function onBtnTest2() {
	console.log("Test 2");
	const columnDefs = gridOptions.api.getColumnDefs();
	console.log(columnDefs);
}

function setTitleRow(title, size) {
	var delimiter =  $("input[type='radio'][name='delimiterInput']:checked").val() //document.getElementById("delimiterInput").value;
  var quotes = $("input[type='radio'][name='quotesInput']:checked").val() //document.getElementById("quotesInput").value;
	document.querySelector("#fileTitle").innerHTML = title + " | size: " + size + " | parsed with '" + delimiter + "' as column delimiter and '" + quotes + "' as text quotes";
}


// 
// Paste 
//

function inputGrid(){
	var textinput = document.getElementById("pasteText").value;
	setTitleRow("Text Input", humanFileSize(byteCount(textinput)));
	createGrid(textinput);
}


//
// Filestack
// 
const client = filestack.init("AaZv0uyTZmBD0H4g9mWbAz");

const options = {
	displayMode: "dropPane",
	container: "picker",
    onFileSelected: file => {
        // If you throw any error in this function it will reject the file selection.
        // The error message will be displayed to the user as an alert.
        if (file.size > 100000 * 1000) {
            throw new Error('File too big, select something smaller than 100MB');
        }
    },
    fromSources: ["local_file_system", "url"],
    accept: ["text/*"],
    customText: {
    	'Select Files to Upload': 'Select CSV File to Upload',
    	'Drag and Drop, Copy and Paste Files': 'Drag and Drop CSV File to Upload or Click and Select'
    },
    onFileUploadFinished: file => {	
    	createGridUrl(file.url, file.originalFile.name);
    }
};

client.picker(options).open();


//
// Grid
// 
 	  // lookup the container we want the Grid to use
	  const eGridDiv = document.querySelector("#csvGrid");

 	  var gridOptions = {};

 	  function createGridUrl(url, file){
		  console.log("createGridUrl");

		  	//activate Spinner
		  	document.querySelector(".wrapper").style.display = "none";
		  	document.querySelector("#gridWrapper").style.display = "block";
		  	document.querySelector(".loadingDiv").style.display = "block";

	      const Http = new XMLHttpRequest();
	      Http.open("GET", url);
	      Http.send();

	      Http.onreadystatechange = function() {

	      	if(Http.readyState === XMLHttpRequest.DONE) {
		        var status = Http.status;
		        if (status === 0 || (status >= 200 && status < 400)) {
			        console.log("csv file load success");
							
							document.querySelector("#loadedUrl").value = url;

			        text = Http.responseText;
			        if(!file) file = url;
			        setTitleRow("<a href='" + url +"' target='_blank'>" + file + "</a>", humanFileSize(byteCount(text)));
			        createGrid(text);
			     } else {
			     		document.querySelector(".loadingDiv").style.display = "none";
      				console.log("Oh no! There has been an error with the request!"); 
    			}
	    	}
	      };
 	  }


      function createGrid(text){ 

			  var delimiter =  $("input[type='radio'][name='delimiterInput']:checked").val() //document.getElementById("delimiterInput").value;
			  var quotes = $("input[type='radio'][name='quotesInput']:checked").val() //document.getElementById("quotesInput").value;
      	var supQuotes = false;
      	if(quotes == "") supQuotes = true;


      	document.querySelector(".wrapper").style.display = "none";
      	document.querySelector(".loadingDiv").style.display = "none";
      	document.querySelector("#gridWrapper").style.display = "block";

				$('#csvGrid').height($(window).height() - 200);


	      gridOptions = {
	        statusBar: {
	          statusPanels: [
	            {
	              statusPanel: "agTotalAndFilteredRowCountComponent",
	              key: "totalAndFilter",
	              align: "left"
	            },
	            { statusPanel: "agSelectedRowCountComponent", align: "left" },
	            { statusPanel: "agAggregationComponent", align: "right" }
	          ]
	        },
	        defaultCsvExportParams: {
	        	fileName: formatDate() + "_export.csv",
	        	columnSeparator: delimiter,
	        	suppressQuotes: supQuotes  	
	        },
	        defaultExcelExportParams: {
	        	fileName: formatDate() + "_export.xls",
	        	author: "HeyCSV.com",
	        	sheetName: "HeyCSV.com",     	
	        },
	        defaultColDef: {
	          sortable: true,
	          filter: true,
	          resizable: true,
	          enableRowGroup: true,
	          enableValue: true,
	          enablePivot: true
	        },
	        rowSelection: "multiple",
	        singleClickEdit: false,
	        enableCellChangeFlash: true,
	        enableFillHandle: true,
	        debug: true,
	        enableRangeSelection: true,
	        rowDragManaged: true,
	        enableMultiRowDragging: true,
	        rowSelection: "multiple",
	        groupSelectsChildren: true,
	        undoRedoCellEditing: true,
    			undoRedoCellEditingLimit: 50,
	        animateRows: true,
	        suppressDragLeaveHidesColumns: true,
	        suppressMakeColumnVisibleAfterUnGroup: true,
	        suppressFieldDotNotation: true,
	        rowGroupPanelShow: "always",
	        sideBar: {
          		toolPanels: ["columns", "filters"]
        	},
        	sideBar: true,
        	onFirstDataRendered: onFirstDataRendered
	     };

	      // create the grid passing in the div to use together with the columns & data we want to use
	      new agGrid.Grid(eGridDiv, gridOptions);

	      // parse text to get csv rows
	      var csvRows = parseCSV(text, delimiter, quotes);
	      console.log(csvRows[0].length + " Cols");
	      console.log(csvRows.length + " Rows");

	      // add artificial header when header checkbox false.
		    if(!document.querySelector("#headerChecked").checked) {
		    	var newHeader = [];
		    	newHeader.push("#Row");
		    	for (var col = 1; col < csvRows[0].length; col++) {
		    		newHeader.push("Column " + col);
		    		console.log("Column " + col);
		    	}
		    	var newRows = [];
		    	newRows.push(newHeader);

		    	for (var row = 0; row < csvRows.length; row++) {
		    			newRows.push(csvRows[row]);
		    	}

		    	console.log(newRows[0]);
		      var colDefs = createCols(newRows[0]);
		      var rowData = JSON.parse(parseCSVtoObjects(newRows));
		    } else {
			    console.log(csvRows[0]);
		      var colDefs = createCols(csvRows[0]);
		      var rowData = JSON.parse(parseCSVtoObjects(csvRows));
		    }

	      // create grid
	      console.log(rowData);
	      gridOptions.api.setColumnDefs(colDefs);
	      gridOptions.api.setRowData(rowData);
	      console.log("rows created");

      }

	    function onFirstDataRendered(params) {
  			
	    	// activate Nav Links
	    	var element = document.getElementById("navbarExport");
  			element.classList.remove("disabled");
  			element = document.getElementById("navbarReset");
  			element.classList.remove("disabled");
  			element = document.getElementById("reload");
  			element.classList.remove("disabled");

  			  var allColumnIds = [];
			  gridOptions.columnApi.getAllColumns().forEach(function (column) {
			    allColumnIds.push(column.colId);
			  });

  			gridOptions.columnApi.autoSizeColumns(allColumnIds, false);
		}

	 	function onQuickFilterChanged() {
  			gridOptions.api.setQuickFilter(document.getElementById('quickFilter').value);
	  	}	

      function createCols(headers) {
        console.log("createCols");

        var colCount = headers.length;
        var columns = [];


        for (var col = 0; col < colCount; col++) {
          if (col == 0) {
            var colDef = { 
              colId: "Col_" + col,
              field: headers[col], 
              hide: true,
              editable: false,
              headerName: headers[col], 
              rowDrag: true, 
              headerCheckboxSelection: true,
              checkboxSelection: true,
	          	checkboxSelection: function(params) {
                    // we put checkbox on the name if we are not doing grouping
                    return params.columnApi.getRowGroupColumns().length === 0;
                },
                headerCheckboxSelection: function(params) {
                    // we put checkbox on the name if we are not doing grouping
                    return params.columnApi.getRowGroupColumns().length === 0;
                },
                headerCheckboxSelectionFilteredOnly: true
            };

            var autoColDef = {
            	field: headers[col],  	
            	minWidth: 250,
		        	headerName: "Group",
		        	headerCheckboxSelection: true,
					    cellRendererParams: {
					        checkbox: true
					    }
            }

            gridOptions.api.setAutoGroupColumnDef(autoColDef);

          } else {
            var colDef = { 
              colId: "Col_" + col,
              field: headers[col],
              headerName: headers[col],
              editable: true
          	};
          }
          columns.push(colDef);
        }

        return columns;
      }


//
// CSV Parsing
//

	    function parseCSV(str, delimiter, quotes) {
	    	console.log("parse Start");
		    var arr = [];
		    var quote = false;
		    for (var row = col = c = 0; c < str.length; c++) {
		        
		        var cc = str[c], nc = str[c+1];
		        arr[row] = arr[row] || [];
		        arr[row][col] = arr[row][col] || '';

		        // Always add additional incremental column to have # row 
		        if(row == 0 && col == 0) {
		        	// add artificial header when header checkbox false.
		    			if(!document.querySelector("#headerChecked").checked) { 
		    				arr[row][col] = "1"; 
		    			} else {
		    				arr[row][col] = "#Row";
		    			}
		        	
		        	++col;
		        	--c;
		        	continue;
		        }
		        if(row != 0 && col == 0) {
		        	if(!document.querySelector("#headerChecked").checked) { 
		    				arr[row][col] = row + 1; 
		    			} else {
		    				arr[row][col] = row;
		    			}
		        	++col;
		        	--c;
		        	continue;
		        }

		        if (cc == quotes && quote && nc == quotes) { arr[row][col] += cc; ++c; continue; }  
		        if (cc == quotes) { quote = !quote; continue; }
		        if (cc == delimiter && !quote) { ++col; continue; }
		        if (cc == '\r' && nc == '\n' && !quote) { ++row; col = 0; ++c; continue; }
		        if (cc == '\n' && !quote) { ++row; col = 0; continue; }
		        if (cc == '\r' && !quote) { ++row; col = 0; continue; }

		        arr[row][col] += cc;
		    }
		    console.log("parse End");
		    return arr;
		}


      function parseCSVtoObjects(csvRows, /* optional */ columnNames) {
        console.log("CSVtoObject start");

        var firstDataRow = 0;
        if (!columnNames) {
          columnNames = csvRows[0];
          firstDataRow = 1;
        }

        var result = [];
        for (var i = firstDataRow, n = csvRows.length; i < n; i++) {
          var rowObject = {};
          var row = csvRows[i];
          for (
            var j = 0, m = Math.min(row.length, columnNames.length);
            j < m;
            j++
          ) {
            var columnName = columnNames[j];
            var columnValue = row[j];
            rowObject[columnName] = columnValue;
          }
          result.push(rowObject);
        }

        console.log("CSVtoObject end");
        return JSON.stringify(result); //JSON
      }

//
// Helper
//

      function formatDate() {
		    var d = new Date(),
		        minute = '' + d.getMinutes(),
		        hour = '' + d.getHours(),
		        month = '' + (d.getMonth() + 1),
		        day = '' + d.getDate(),
		        year = d.getFullYear();

		    if (month.length < 2) 
		        month = '0' + month;
		    if (day.length < 2) 
		        day = '0' + day;

    		return year + month + day + hour + minute;
			}

			function byteCount(s) {
			    return encodeURI(s).split(/%..|./).length - 1;
			}

			function humanFileSize(size) {
    		var i = Math.floor( Math.log(size) / Math.log(1000) );
    		return ( size / Math.pow(1000, i) ).toFixed(2) * 1 + ' ' + ['B', 'kB', 'MB', 'GB', 'TB'][i];
			};
    </script>

:ET